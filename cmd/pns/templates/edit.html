<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>PNS: {{if .Edit}}Edit note #{{.ID}}{{else if .Copy}}Adding copy of note #{{.ID}}{{else}}Add note{{end}}</title>
<link type="text/css" rel="stylesheet" href="/_/static/style.css">
<link type="text/css" rel="stylesheet" href="/_/static/edit.css">
<link rel="stylesheet" href="/_/static/awesomplete.css" />
<link rel="icon" href="/_/static/favicon.png" />
<script src="/_/static/awesomplete.js"></script>
<script src="/_/static/pns.js" async></script>
<script>
referer = {{.Referer}};

function setup() {
	newAwesomplete(null);
{{if .EditConflict}}
	setTargetAndAction('preview', 'DiffConflict');
	document.getElementById("form").submit();
{{end}}
}
</script>
</head>

<body onload="setup();" onkeydown="return editKeyDown(event, referer);">
<form action="{{if .Edit}}/_/edit/submit/{{.ID}}{{else}}/_/add/submit{{end}}" method="post" id="form">
<input type="hidden" name="action" id="action" value="Preview">
{{if .Edit}}<input type="hidden" name="sha1sum" value="{{.SHA1Sum}}">{{end}}

<div class="topbar">
<div class="topbar-left">
<div class="awesomplete">
<input type="text" name="tag" id="tag" placeholder="Topics and tags" class="taginput"
       data-list="{{.TopicsAndTagsComma}}" data-multiple autofocus value="{{.NoteTopicsAndTags}}"></input>
</div>
</div>
<div class="topbar-inner">
<div class="topbar-right">
<ul class="tagbar">
{{with .Referer}}<li><input type="button" value="Cancel" class="button" onclick="location = referer"></input></li>{{end}}
<li><input type="submit" value="Preview" class="button" onclick="setTargetAndAction('preview', 'Preview')"></input></li>
{{if .Edit}}
<li><input type="submit" value="Diff" class="button" onclick="setTargetAndAction('preview', 'Diff')"></input></li>
{{end}}
<li><input type="submit" value="Submit" class="button" onclick="setTargetAndAction('', 'Submit')"></input></li>
</ul>
</div>
</div>
</div>

<div class="content">
<textarea name="text" id="text">{{.Text}}</textarea>
<iframe name="preview" src="{{if and (or .Edit .Copy) (not .EditConflict)}}/_/edit/preview/{{.ID}}{{end}}"></iframe>
</div>

</form>
</body>
</html>
