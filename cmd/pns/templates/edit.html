<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>PNS: {{if .Edit}}Edit note #{{.ID}}{{else if .Copy}}Adding copy of note #{{.ID}}{{else}}Add note{{end}}</title>
<link type="text/css" rel="stylesheet" href="/_/static/style.css">
<link type="text/css" rel="stylesheet" href="/_/static/edit.css">
<link rel="stylesheet" href="/_/static/semantic.css" />
<link rel="stylesheet" href="/_/static/awesomplete.css" />
<link rel="icon" href="/_/static/favicon.png" />
<script src="/_/static/awesomplete.js"></script>
<script src="/_/static/pns.js" async></script>
<script>
referer = {{.Referer}};

function setup() {
	newAwesomplete(null);
{{if .EditConflict}}
	setTargetAndAction('preview', 'DiffConflict');
	document.getElementById("form").submit();
{{end}}
}
</script>
</head>

<body class="body" onload="setup();" onkeydown="return editKeyDown(event, referer);">
<form class="edit" action="{{if .Edit}}/_/edit/submit/{{.ID}}{{else}}/_/add/submit{{end}}" method="post" id="form">

<div class="ui top fixed menu">

<div class="item ui transparent input">
<input type="text" name="tag" id="tag" placeholder='{{tr "Topics and tags"}}' class="taginput"
       data-list="{{.TopicsAndTagsComma}}" data-multiple autofocus value="{{.NoteTopicsAndTags}}"></input>
</div>

<div class="right menu">

{{with .Referer}}
<a class="item" onclick="location = referer">{{tr "Cancel"}}</a>
{{end}}

<a class="item ui transparent input">
<input type="submit" value='{{tr "Preview"}}' onclick="setTargetAndAction('preview', 'Preview')"></input>
</a>

{{if .Edit}}
<a class="item ui transparent input">
<input type="submit" value='{{tr "Diff"}}' onclick="setTargetAndAction('preview', 'Diff')"></input>
</a>
{{end}}

<a class="item ui transparent input">
<input type="submit" value='{{tr "edit|Submit"}}' onclick="setTargetAndAction('', 'Submit')"></input>
</a>

</div>

</div>

<input type="hidden" name="action" id="action" value="Preview">
{{if .Edit}}<input type="hidden" name="sha1sum" value="{{.SHA1Sum}}">{{end}}

<div class="content">
<textarea class="edit" name="text" id="text">{{.Text}}</textarea>
<iframe name="preview" src="{{if and (or .Edit .Copy) (not .EditConflict)}}/_/edit/preview/{{.ID}}{{end}}"></iframe>
</div>

</form>
</body>
</html>
